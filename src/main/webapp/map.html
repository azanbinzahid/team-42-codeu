<!DOCTYPE html>
<html>
<head>
    <title>Opportunity Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src='/js/config.js'></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script> 
    
    <!-- <script id="api" src=""></script> -->
    <script>
        const mapAPI = config.api
        var script = document.createElement( 'script' );
        script.type = 'text/javascript';
        script.src = "https://maps.googleapis.com/maps/api/js?key=" + mapAPI;
        document.head.append( script );
    </script>

    <script>  
        function getCoordinates(){
            const mapAPI = config.api
            
            const map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 0, lng: 0},
                zoom:3
            });

            var cities = ["Lahore", "Karachi", "New York", "Perth", "London", "Berlin", "Mali"] //fetch from backend along with tile and description
            var id = 0
            cities.forEach((city)=>{
                id = id + 1 //will get this from bacj-end as well
                fetch('https://maps.googleapis.com/maps/api/geocode/json?address='+city+'&key='+mapAPI)
                .then(respose=>{
                    return respose.json()
                })
                .then(function(jsonObject){
                    return (jsonObject.results[0].geometry.location) //parse json object to get coordinates
                })
                .then((data)=>{
                    const marker =  new google.maps.Marker({
                        position: {lat: data.lat, lng: data.lng},
                        map: map,
                        title: "TITLE"
                    });  
                    const infoWindow = new google.maps.InfoWindow({
                        content: "<a href=opportunities.html?id=" + id + ">" + DESCRIPTION + "</a>"
                    });
                    marker.addListener('click', function() {
                        infoWindow.open(map, marker);
                    });
                });
            });
        };
     </script>

    <style>
        #map{
        height: 100%;
        }
        html, body{
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>

</head>

<body onload="getCoordinates();">
 <h1>Opportunities Map</h1>
 <div id="map" ></div>
</body>

</html>