<!DOCTYPE html>
<html>

  <head>
    <title>CS OPPORTUNITIES</title>
    <script defer src="https://use.fontawesome.com/releases/v5.6.3/js/all.js"></script>
    <script src = "/js/opportunity.js"></script>
    <link rel="stylesheet" href="/css/opportunity.css">
    <link rel="stylesheet" href="/css/opportunities.css">
    <script>
      function openSlideMenu(){
        document.getElementById('menu').style.width = '250px';
        document.getElementById('content').style.marginLeft = '250px';
        document.getElementById('content').style.opacity = '0.5';
        
      }
      function closeSlideMenu(){
        document.getElementById('menu').style.width = '0';
        document.getElementById('content').style.marginLeft = '0';
        document.getElementById('content').style.opacity = '1';
      }
    </script>
    <script>
      function displayTitles(){
        fetch('/map')
        .then(data=>{ 
          return data.json()
        })
        .then(data=>{	
          var id = 0
          var opportunitiesTitles = data[1];
          var opportunitiesDueDate = data[2];
          var opportunitiesRecuurintStatus = data[3];

          console.log(opportunitiesDueDate)
          

          opportunitiesTitles.forEach(element => {
            var date = new Date (opportunitiesDueDate[id])
            var today = new Date();
            var classID = "active-list" 

            if (date.getTime() > today.getTime()){
              classID = "active-list"
            } else if (date.getTime() < today.getTime()) {
              if (opportunitiesRecuurintStatus[id] === true){
                classID = "recurring-list";
              } else {
                classID = "archived-list";
              }
            }

            id++
            var menu = document.getElementById(classID)
            var title = document.createElement('li')
            title.innerHTML = "<a href='opportunities.html?id=" + id + "' > " + element + "</a>"
            menu.appendChild(title);
            
        });
      })
    }

    </script>
    <script>
      const displayOpportunity = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const parameterId = urlParams.get('id');
        const url = '/getOpportunity?id=' + parameterId;
        fetch(url).then((response) => {
          return response.json();
        }).then((opportunity) => {
          document.getElementById('title').innerHTML = opportunity.title
          document.getElementById('due-date').innerHTML = opportunity.dueDate
          document.getElementById('img').src = opportunity.advertisementImageUrl
          document.getElementById('desc').innerHTML = opportunity.description
          document.getElementById('applyLink').href = opportunity.applyLink
          
          var detailsContainer = document.getElementById("details")
          var details = detailsContainer.getElementsByTagName("ul")[0]
          var detailPoint = document.createElement("li")
          detailPoint.innerHTML = "Location: " + opportunity.city + ", " + opportunity.country 
          details.appendChild(detailPoint)
          var detailPoint = document.createElement("li")
          detailPoint.innerHTML = "Start Date: " + opportunity.startDate 
          details.appendChild(detailPoint)
          var details = opportunity.opportunityDetails


          details.forEach(detail=>{
            // console.log(detail);
            var detailsContainer = document.getElementById("details")
            var details = detailsContainer.getElementsByTagName("ul")[0]
            var detailPoint = document.createElement("li")
            detailPoint.innerHTML = detail
            details.appendChild(detailPoint)
          });

          var reqContainer = document.getElementById("other-req")
          var reqs = reqContainer.getElementsByTagName("ul")[0]
          var reqPoint = document.createElement("li")
          reqPoint.innerHTML = "Minimum Age: " + opportunity.minAge
          reqs.appendChild(reqPoint)

          var reqPoint = document.createElement("li")
          reqPoint.innerHTML = "Maximum Age: " + opportunity.maxAge
          reqs.appendChild(reqPoint)

          var reqPoint = document.createElement("li")
          reqPoint.innerHTML = "Education Level: " + opportunity.eductationLevel
          reqs.appendChild(reqPoint)

          var reqPoint = document.createElement("li")
          reqPoint.innerHTML = "Open For Gender(s): " + opportunity.gender
          reqs.appendChild(reqPoint)


          var otherRequirments = opportunity.otherRequirments
          otherRequirments.forEach(req=>{
            // console.log(req);
            var reqContainer = document.getElementById("other-req")
            var reqs = reqContainer.getElementsByTagName("ul")[0]
            var reqPoint = document.createElement("li")
            reqPoint.innerHTML = req
            reqs.appendChild(reqPoint)
          });
          var additionalLinks = opportunity.additionalLinks
          additionalLinks.forEach(link=>{
            // console.log(link);
            var linkContainer = document.getElementById("additional-links")
            var links = linkContainer.getElementsByTagName("ul")[0]
            var linkPoint = document.createElement("li")
            linkPoint.innerHTML = link
            links.appendChild(linkPoint)
          });
        });
      }
      </script>
      <script>
          function searchFunction() {
            // Declare variables
            var input, filter, ul, li, a, i, txtValue;
            input = document.getElementById('myInput');
            filter = input.value.toUpperCase();
            var ULs = document.getElementsByClassName('search');
            // console.log(ULs)
            for (j = 0; j < ULs.length; j++) {
              ul = ULs[j]
              li = ul.getElementsByTagName('li'); 
            
              // Loop through all list items, and hide those who don't match the search query
              for (i = 0; i < li.length; i++) {
                a = li[i].getElementsByTagName("a")[0];
                txtValue = a.textContent || a.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                  li[i].style.display = "";
                } else {
                  li[i].style.display = "none";
                }
              }
            } 
          }
          </script>
  </head>
  
  <body onload="loadFunc(); displayTitles(); displayOpportunity()">
      <div id="loader"></div>
      
      <div id="menu" class="nav">
        <span>
          <a href="#" class="close" onclick="closeSlideMenu()">
            <i class="fas fa-times"></i>
          </a>
          <p></p>
        </span>
        <input type="text" id="myInput" onkeyup="searchFunction()" placeholder="Search for Opportunities..">
        <button class="dropdown-btn">Active
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-container">
          <ul id="active-list" class="search"></ul>
        </div>
        
        <button class="dropdown-btn">Archived
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-container">
          <ul id="archived-list" class="search"></ul>
        </div>
        
        
        <button class="dropdown-btn">Reccuring
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-container">
          <ul id="recurring-list" class="search"></ul>
        </div>
      
    
    </div>
      
    <div id="content" style="display:none;" class="animate-bottom"> 
        
      <span class="slide">
        <a href="#" onclick="openSlideMenu()">
          <i class="fas fa-bars"></i>
        </a>
      </span>
    
      <div>
        <h2 id = 'title' class='opportunity-title'> Title </h2>
        <p></p>
      </div>

      <div>
        <image id='img' class='OpportunityImage' src=#></image>
      </div>
    
      <div>
        <p id = 'desc'> DESCRIPTION </p>
      </div>

      <div>
        <h2 class='opportunity-title'> ScholarShip Details </h2>
      </div>

      <div id = 'details'>
        <ul></ul>
      </div>

      <div>
          <h2 class='opportunity-title'> Eligibility Criteria </h2>
      </div>

      <div id = 'other-req'>
        <ul></ul>
      </div>

      <div>
        <h3 class='opportunity-title'>
          Due Date: 
          <font id= 'due-date' class='blackText'> DUE STRING </font>
        </h3>
      </div>

      <div>
        <a id = 'applyLink' style='text-decoration: none;' target='blank' href=applyLink>
          <button id='applyButton' onclick=applyLink>
            <span id='applyButtonText'>Apply Now</span>
          </button>
        </a>
      </div>

      <div><h2 class='opportunity-title'> Additional Links </h2></div>
        
      <div id='additional-links'>
        <ul></ul>
      </div>
    
    </div>	



  <script>
    var myVar;
    
    function loadFunc() {
      myVar = setTimeout(showPage, 700);
    }
    
    function showPage() {
      document.getElementById("loader").style.display = "none";
      document.getElementById("content").style.display = "block";
    }
  </script>

  <script>
    var dropdown = document.getElementsByClassName("dropdown-btn");
    var i;

    for (i = 0; i < dropdown.length; i++) {
      dropdown[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var dropdownContent = this.nextElementSibling;
        if (dropdownContent.style.display === "block") {
          dropdownContent.style.display = "none";
        } else {
          dropdownContent.style.display = "block";
        }
      });
    } 
  </script>
  
  </body>
</html> 